/*! @svgdotjs/svg.resize.js v2.0.4 MIT*/;
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@svgdotjs/svg.js")):"function"==typeof define&&define.amd?define(["exports","@svgdotjs/svg.js"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).svg=e.svg||{},e.svg.resize=e.svg.resize||{},e.svg.resize.js={}),e.SVG)}(this,(function(e,t){"use strict";function i(e,t,i,s=null){return function(n){n.preventDefault(),n.stopPropagation();var o=n.pageX||n.touches[0].pageX,h=n.pageY||n.touches[0].pageY;t.fire(e,{x:o,y:h,event:n,index:s,points:i})}}function s([e,t],{a:i,b:s,c:n,d:o,e:h,f:a}){return[e*i+t*n+h,e*s+t*o+a]}class n{constructor(e){this.el=e,e.remember("_selectHandler",this),this.selection=new t.G,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const i=t.getWindow();this.observer=new i.MutationObserver(this.mutationHandler)}init(e){this.createHandle=e.createHandle||this.createHandleFn,this.createRot=e.createRot||this.createRotFn,this.updateHandle=e.updateHandle||this.updateHandleFn,this.updateRot=e.updateRot||this.updateRotFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createResizeHandles(),this.updateResizeHandles(),this.createRotationHandle(),this.updateRotationHandle(),this.observer.observe(this.el.node,{attributes:!0})}active(e,t){if(!e)return this.selection.clear().remove(),void this.observer.disconnect();this.init(t)}createSelection(){this.selection.polygon(this.handlePoints).addClass("svg_select_shape")}updateSelection(){this.selection.get(0).plot(this.handlePoints)}createResizeHandles(){this.handlePoints.forEach(((e,t,s)=>{const n=this.order[t];this.createHandle.call(this,this.selection,e,t,s,n),this.selection.get(t+1).addClass("svg_select_handle svg_select_handle_"+n).on("mousedown.selection touchstart.selection",i(n,this.el,this.handlePoints,t))}))}createHandleFn(e){e.polyline()}updateHandleFn(e,t,i,s){const n=s.at(i-1),o=s[(i+1)%s.length],h=t,a=[h[0]-n[0],h[1]-n[1]],r=[h[0]-o[0],h[1]-o[1]],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]),d=Math.sqrt(r[0]*r[0]+r[1]*r[1]),c=[a[0]/l,a[1]/l],p=[r[0]/d,r[1]/d],u=[h[0]-10*c[0],h[1]-10*c[1]],v=[h[0]-10*p[0],h[1]-10*p[1]];e.plot([u,h,v])}updateResizeHandles(){this.handlePoints.forEach(((e,t,i)=>{const s=this.order[t];this.updateHandle.call(this,this.selection.get(t+1),e,t,i,s)}))}createRotFn(e){e.line(),e.circle(5)}getPoint(e){return this.handlePoints[this.order.indexOf(e)]}getPointHandle(e){return this.selection.get(this.order.indexOf(e)+1)}updateRotFn(e,t){const i=this.getPoint("t");e.get(0).plot(i[0],i[1],t[0],t[1]),e.get(1).center(t[0],t[1])}createRotationHandle(){const e=this.selection.group().addClass("svg_select_handle_rot").on("mousedown.selection touchstart.selection",i("rot",this.el,this.handlePoints));this.createRot.call(this,e)}updateRotationHandle(){const e=this.selection.findOne("g.svg_select_handle_rot");this.updateRot(e,this.rotationPoint,this.handlePoints)}updatePoints(){const e=this.el.bbox(),t=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.handlePoints=this.getHandlePoints(e).map((e=>s(e,t))),this.rotationPoint=s(this.getRotationPoint(e),t)}getHandlePoints({x:e,x2:t,y:i,y2:s,cx:n,cy:o}=this.el.bbox()){return[[e,i],[n,i],[t,i],[t,o],[t,s],[n,s],[e,s],[e,o]]}getRotationPoint({y:e,cx:t}=this.el.bbox()){return[t,e-20]}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updateResizeHandles(),this.updateRotationHandle()}}const o=e=>function(t=!0,i={}){"object"==typeof t&&(i=t,t=!0);let s=this.remember("_"+e.name);return s||(t.prototype instanceof n?(s=new t(this),t=!0):s=new e(this),this.remember("_"+e.name,s)),s.active(t,i),this};t.extend(t.Element,{select:o(n)}),t.extend([t.Polygon,t.Polyline,t.Line],{pointSelect:o(class{constructor(e){this.el=e,e.remember("_pointSelectHandler",this),this.selection=new t.G,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const i=t.getWindow();this.observer=new i.MutationObserver(this.mutationHandler)}init(e){this.createHandle=e.createHandle||this.createHandleFn,this.updateHandle=e.updateHandle||this.updateHandleFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createPointHandles(),this.updatePointHandles(),this.observer.observe(this.el.node,{attributes:!0})}active(e,t){if(!e)return this.selection.clear().remove(),void this.observer.disconnect();this.init(t)}createSelection(){this.selection.polygon(this.points).addClass("svg_select_shape_pointSelect")}updateSelection(){this.selection.get(0).plot(this.points)}createPointHandles(){this.points.forEach(((e,t,s)=>{this.createHandle.call(this,this.selection,e,t,s),this.selection.get(t+1).addClass("svg_select_handle_point").on("mousedown.selection touchstart.selection",i("point",this.el,this.points,t))}))}createHandleFn(e){e.circle(5)}updateHandleFn(e,t){e.center(t[0],t[1])}updatePointHandles(){this.points.forEach(((e,t,i)=>{this.updateHandle.call(this,this.selection.get(t+1),e,t,i)}))}updatePoints(){const e=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.points=this.el.array().map((t=>s(t,e)))}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updatePointHandles()}})});const h=e=>(e.changedTouches&&(e=e.changedTouches[0]),{x:e.clientX,y:e.clientY}),a=e=>{let i=1/0,s=1/0,n=-1/0,o=-1/0;for(let t=0;t<e.length;t++){const h=e[t];i=Math.min(i,h[0]),s=Math.min(s,h[1]),n=Math.max(n,h[0]),o=Math.max(o,h[1])}return new t.Box(i,s,n-i,o-s)};class r{constructor(e){this.el=e,e.remember("_ResizeHandler",this),this.lastCoordinates=null,this.eventType="",this.lastEvent=null,this.handleResize=this.handleResize.bind(this),this.resize=this.resize.bind(this),this.endResize=this.endResize.bind(this),this.rotate=this.rotate.bind(this),this.movePoint=this.movePoint.bind(this)}active(e,t){this.preserveAspectRatio=t.preserveAspectRatio??!1,this.aroundCenter=t.aroundCenter??!1,this.grid=t.grid??0,this.degree=t.degree??0,this.el.off(".resize"),e&&(this.el.on(["lt.resize","rt.resize","rb.resize","lb.resize","t.resize","r.resize","b.resize","l.resize","rot.resize","point.resize"],this.handleResize),this.lastEvent&&("rot"===this.eventType?this.rotate(this.lastEvent):"point"===this.eventType?this.movePoint(this.lastEvent):this.resize(this.lastEvent)))}handleResize(e){this.eventType=e.type;const{event:i,index:s,points:n}=e.detail,o=!i.type.indexOf("mouse");if(o&&1!==(i.which||i.buttons))return;if(this.el.dispatch("beforeresize",{event:e,handler:this}).defaultPrevented)return;this.box=this.el.bbox(),this.startPoint=this.el.point(h(i)),this.index=s,this.points=n.slice();const a=(o?"mousemove":"touchmove")+".resize",r=(o?"mouseup":"touchcancel.resize touchend")+".resize";"point"===e.type?t.on(window,a,this.movePoint):"rot"===e.type?t.on(window,a,this.rotate):t.on(window,a,this.resize),t.on(window,r,this.endResize)}resize(e){this.lastEvent=e;const i=this.snapToGrid(this.el.point(h(e)));let s=i.x-this.startPoint.x,n=i.y-this.startPoint.y;this.preserveAspectRatio&&this.aroundCenter&&(s*=2,n*=2);const o=this.box.x+s,r=this.box.y+n,l=this.box.x2+s,d=this.box.y2+n;let c=new t.Box(this.box);if(this.eventType.includes("l")&&(c.x=Math.min(o,this.box.x2),c.x2=Math.max(o,this.box.x2)),this.eventType.includes("r")&&(c.x=Math.min(l,this.box.x),c.x2=Math.max(l,this.box.x)),this.eventType.includes("t")&&(c.y=Math.min(r,this.box.y2),c.y2=Math.max(r,this.box.y2)),this.eventType.includes("b")&&(c.y=Math.min(d,this.box.y),c.y2=Math.max(d,this.box.y)),c.width=c.x2-c.x,c.height=c.y2-c.y,this.preserveAspectRatio){const e=c.width/this.box.width,t=c.height/this.box.height,i=["lt","t","rt","r","rb","b","lb","l"],s=(i.indexOf(this.eventType)+4)%i.length,n=this.aroundCenter?[this.box.cx,this.box.cy]:this.points[s];let o=this.eventType.includes("t")||this.eventType.includes("b")?t:e;o=2===this.eventType.length?Math.max(e,t):o,c=function(e,t,i){const s=[[e.x,e.y],[e.x+e.width,e.y],[e.x+e.width,e.y+e.height],[e.x,e.y+e.height]].map((([e,s])=>{const n=e-t[0],o=(s-t[1])*i;return[n*i+t[0],o+t[1]]}));return a(s)}(this.box,n,o)}this.el.dispatch("resize",{box:new t.Box(c),angle:0,eventType:this.eventType,event:e,handler:this}).defaultPrevented||this.el.size(c.width,c.height).move(c.x,c.y)}movePoint(e){this.lastEvent=e;const{x:t,y:i}=this.snapToGrid(this.el.point(h(e))),s=this.el.array().slice();s[this.index]=[t,i],this.el.dispatch("resize",{box:a(s),angle:0,eventType:this.eventType,event:e,handler:this}).defaultPrevented||this.el.plot(s)}rotate(e){this.lastEvent=e;const i=this.startPoint,s=this.el.point(h(e)),{cx:n,cy:o}=this.box,a=i.x-n,r=i.y-o,l=s.x-n,d=s.y-o,c=Math.sqrt(a*a+r*r)*Math.sqrt(l*l+d*d);if(0===c)return;let p=Math.acos((a*l+r*d)/c)/Math.PI*180;if(!p)return;s.x<i.x&&(p=-p);const u=new t.Matrix(this.el),{x:v,y:x}=new t.Point(n,o).transformO(u),{rotate:b}=u.decompose(),g=this.snapToAngle(b+p)-b;this.el.dispatch("resize",{box:this.box,angle:g,eventType:this.eventType,event:e,handler:this}).defaultPrevented||this.el.transform(u.rotateO(g,v,x))}endResize(e){"rot"!==this.eventType&&"point"!==this.eventType&&this.resize(e),this.lastEvent=null,this.eventType="",t.off(window,"mousemove.resize touchmove.resize"),t.off(window,"mouseup.resize touchend.resize")}snapToGrid(e){return this.grid&&(e.x=Math.round(e.x/this.grid)*this.grid,e.y=Math.round(e.y/this.grid)*this.grid),e}snapToAngle(e){return this.degree&&(e=Math.round(e/this.degree)*this.degree),e}}t.extend(t.Element,{resize:function(e=!0,t={}){"object"==typeof e&&(t=e,e=!0);let i=this.remember("_ResizeHandler");return i||(e.prototype instanceof r?(i=new e(this),e=!0):i=new r(this),this.remember("_resizeHandler",i)),i.active(e,t),this}}),e.ResizeHandler=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=svg.resize.umd.cjs.map
