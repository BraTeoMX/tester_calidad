/*! @svgdotjs/svg.resize.js v2.0.4 MIT*/;
this.svg=this.svg||{},this.svg.resize=this.svg.resize||{},this.svg.resize.js=function(t,e){"use strict";function i(t,e,i,s=null){return function(n){n.preventDefault(),n.stopPropagation();var o=n.pageX||n.touches[0].pageX,h=n.pageY||n.touches[0].pageY;e.fire(t,{x:o,y:h,event:n,index:s,points:i})}}function s([t,e],{a:i,b:s,c:n,d:o,e:h,f:a}){return[t*i+e*n+h,t*s+e*o+a]}class n{constructor(t){this.el=t,t.remember("_selectHandler",this),this.selection=new e.G,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const i=e.getWindow();this.observer=new i.MutationObserver(this.mutationHandler)}init(t){this.createHandle=t.createHandle||this.createHandleFn,this.createRot=t.createRot||this.createRotFn,this.updateHandle=t.updateHandle||this.updateHandleFn,this.updateRot=t.updateRot||this.updateRotFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createResizeHandles(),this.updateResizeHandles(),this.createRotationHandle(),this.updateRotationHandle(),this.observer.observe(this.el.node,{attributes:!0})}active(t,e){if(!t)return this.selection.clear().remove(),void this.observer.disconnect();this.init(e)}createSelection(){this.selection.polygon(this.handlePoints).addClass("svg_select_shape")}updateSelection(){this.selection.get(0).plot(this.handlePoints)}createResizeHandles(){this.handlePoints.forEach(((t,e,s)=>{const n=this.order[e];this.createHandle.call(this,this.selection,t,e,s,n),this.selection.get(e+1).addClass("svg_select_handle svg_select_handle_"+n).on("mousedown.selection touchstart.selection",i(n,this.el,this.handlePoints,e))}))}createHandleFn(t){t.polyline()}updateHandleFn(t,e,i,s){const n=s.at(i-1),o=s[(i+1)%s.length],h=e,a=[h[0]-n[0],h[1]-n[1]],r=[h[0]-o[0],h[1]-o[1]],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]),d=Math.sqrt(r[0]*r[0]+r[1]*r[1]),c=[a[0]/l,a[1]/l],p=[r[0]/d,r[1]/d],u=[h[0]-10*c[0],h[1]-10*c[1]],v=[h[0]-10*p[0],h[1]-10*p[1]];t.plot([u,h,v])}updateResizeHandles(){this.handlePoints.forEach(((t,e,i)=>{const s=this.order[e];this.updateHandle.call(this,this.selection.get(e+1),t,e,i,s)}))}createRotFn(t){t.line(),t.circle(5)}getPoint(t){return this.handlePoints[this.order.indexOf(t)]}getPointHandle(t){return this.selection.get(this.order.indexOf(t)+1)}updateRotFn(t,e){const i=this.getPoint("t");t.get(0).plot(i[0],i[1],e[0],e[1]),t.get(1).center(e[0],e[1])}createRotationHandle(){const t=this.selection.group().addClass("svg_select_handle_rot").on("mousedown.selection touchstart.selection",i("rot",this.el,this.handlePoints));this.createRot.call(this,t)}updateRotationHandle(){const t=this.selection.findOne("g.svg_select_handle_rot");this.updateRot(t,this.rotationPoint,this.handlePoints)}updatePoints(){const t=this.el.bbox(),e=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.handlePoints=this.getHandlePoints(t).map((t=>s(t,e))),this.rotationPoint=s(this.getRotationPoint(t),e)}getHandlePoints({x:t,x2:e,y:i,y2:s,cx:n,cy:o}=this.el.bbox()){return[[t,i],[n,i],[e,i],[e,o],[e,s],[n,s],[t,s],[t,o]]}getRotationPoint({y:t,cx:e}=this.el.bbox()){return[e,t-20]}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updateResizeHandles(),this.updateRotationHandle()}}const o=t=>function(e=!0,i={}){"object"==typeof e&&(i=e,e=!0);let s=this.remember("_"+t.name);return s||(e.prototype instanceof n?(s=new e(this),e=!0):s=new t(this),this.remember("_"+t.name,s)),s.active(e,i),this};e.extend(e.Element,{select:o(n)}),e.extend([e.Polygon,e.Polyline,e.Line],{pointSelect:o(class{constructor(t){this.el=t,t.remember("_pointSelectHandler",this),this.selection=new e.G,this.order=["lt","t","rt","r","rb","b","lb","l","rot"],this.mutationHandler=this.mutationHandler.bind(this);const i=e.getWindow();this.observer=new i.MutationObserver(this.mutationHandler)}init(t){this.createHandle=t.createHandle||this.createHandleFn,this.updateHandle=t.updateHandle||this.updateHandleFn,this.el.root().put(this.selection),this.updatePoints(),this.createSelection(),this.createPointHandles(),this.updatePointHandles(),this.observer.observe(this.el.node,{attributes:!0})}active(t,e){if(!t)return this.selection.clear().remove(),void this.observer.disconnect();this.init(e)}createSelection(){this.selection.polygon(this.points).addClass("svg_select_shape_pointSelect")}updateSelection(){this.selection.get(0).plot(this.points)}createPointHandles(){this.points.forEach(((t,e,s)=>{this.createHandle.call(this,this.selection,t,e,s),this.selection.get(e+1).addClass("svg_select_handle_point").on("mousedown.selection touchstart.selection",i("point",this.el,this.points,e))}))}createHandleFn(t){t.circle(5)}updateHandleFn(t,e){t.center(e[0],e[1])}updatePointHandles(){this.points.forEach(((t,e,i)=>{this.updateHandle.call(this,this.selection.get(e+1),t,e,i)}))}updatePoints(){const t=this.el.parent().screenCTM().inverseO().multiplyO(this.el.screenCTM());this.points=this.el.array().map((e=>s(e,t)))}mutationHandler(){this.updatePoints(),this.updateSelection(),this.updatePointHandles()}})});const h=t=>(t.changedTouches&&(t=t.changedTouches[0]),{x:t.clientX,y:t.clientY}),a=t=>{let i=1/0,s=1/0,n=-1/0,o=-1/0;for(let e=0;e<t.length;e++){const h=t[e];i=Math.min(i,h[0]),s=Math.min(s,h[1]),n=Math.max(n,h[0]),o=Math.max(o,h[1])}return new e.Box(i,s,n-i,o-s)};class r{constructor(t){this.el=t,t.remember("_ResizeHandler",this),this.lastCoordinates=null,this.eventType="",this.lastEvent=null,this.handleResize=this.handleResize.bind(this),this.resize=this.resize.bind(this),this.endResize=this.endResize.bind(this),this.rotate=this.rotate.bind(this),this.movePoint=this.movePoint.bind(this)}active(t,e){this.preserveAspectRatio=e.preserveAspectRatio??!1,this.aroundCenter=e.aroundCenter??!1,this.grid=e.grid??0,this.degree=e.degree??0,this.el.off(".resize"),t&&(this.el.on(["lt.resize","rt.resize","rb.resize","lb.resize","t.resize","r.resize","b.resize","l.resize","rot.resize","point.resize"],this.handleResize),this.lastEvent&&("rot"===this.eventType?this.rotate(this.lastEvent):"point"===this.eventType?this.movePoint(this.lastEvent):this.resize(this.lastEvent)))}handleResize(t){this.eventType=t.type;const{event:i,index:s,points:n}=t.detail,o=!i.type.indexOf("mouse");if(o&&1!==(i.which||i.buttons))return;if(this.el.dispatch("beforeresize",{event:t,handler:this}).defaultPrevented)return;this.box=this.el.bbox(),this.startPoint=this.el.point(h(i)),this.index=s,this.points=n.slice();const a=(o?"mousemove":"touchmove")+".resize",r=(o?"mouseup":"touchcancel.resize touchend")+".resize";"point"===t.type?e.on(window,a,this.movePoint):"rot"===t.type?e.on(window,a,this.rotate):e.on(window,a,this.resize),e.on(window,r,this.endResize)}resize(t){this.lastEvent=t;const i=this.snapToGrid(this.el.point(h(t)));let s=i.x-this.startPoint.x,n=i.y-this.startPoint.y;this.preserveAspectRatio&&this.aroundCenter&&(s*=2,n*=2);const o=this.box.x+s,r=this.box.y+n,l=this.box.x2+s,d=this.box.y2+n;let c=new e.Box(this.box);if(this.eventType.includes("l")&&(c.x=Math.min(o,this.box.x2),c.x2=Math.max(o,this.box.x2)),this.eventType.includes("r")&&(c.x=Math.min(l,this.box.x),c.x2=Math.max(l,this.box.x)),this.eventType.includes("t")&&(c.y=Math.min(r,this.box.y2),c.y2=Math.max(r,this.box.y2)),this.eventType.includes("b")&&(c.y=Math.min(d,this.box.y),c.y2=Math.max(d,this.box.y)),c.width=c.x2-c.x,c.height=c.y2-c.y,this.preserveAspectRatio){const t=c.width/this.box.width,e=c.height/this.box.height,i=["lt","t","rt","r","rb","b","lb","l"],s=(i.indexOf(this.eventType)+4)%i.length,n=this.aroundCenter?[this.box.cx,this.box.cy]:this.points[s];let o=this.eventType.includes("t")||this.eventType.includes("b")?e:t;o=2===this.eventType.length?Math.max(t,e):o,c=function(t,e,i){const s=[[t.x,t.y],[t.x+t.width,t.y],[t.x+t.width,t.y+t.height],[t.x,t.y+t.height]].map((([t,s])=>{const n=t-e[0],o=(s-e[1])*i;return[n*i+e[0],o+e[1]]}));return a(s)}(this.box,n,o)}this.el.dispatch("resize",{box:new e.Box(c),angle:0,eventType:this.eventType,event:t,handler:this}).defaultPrevented||this.el.size(c.width,c.height).move(c.x,c.y)}movePoint(t){this.lastEvent=t;const{x:e,y:i}=this.snapToGrid(this.el.point(h(t))),s=this.el.array().slice();s[this.index]=[e,i],this.el.dispatch("resize",{box:a(s),angle:0,eventType:this.eventType,event:t,handler:this}).defaultPrevented||this.el.plot(s)}rotate(t){this.lastEvent=t;const i=this.startPoint,s=this.el.point(h(t)),{cx:n,cy:o}=this.box,a=i.x-n,r=i.y-o,l=s.x-n,d=s.y-o,c=Math.sqrt(a*a+r*r)*Math.sqrt(l*l+d*d);if(0===c)return;let p=Math.acos((a*l+r*d)/c)/Math.PI*180;if(!p)return;s.x<i.x&&(p=-p);const u=new e.Matrix(this.el),{x:v,y:x}=new e.Point(n,o).transformO(u),{rotate:b}=u.decompose(),y=this.snapToAngle(b+p)-b;this.el.dispatch("resize",{box:this.box,angle:y,eventType:this.eventType,event:t,handler:this}).defaultPrevented||this.el.transform(u.rotateO(y,v,x))}endResize(t){"rot"!==this.eventType&&"point"!==this.eventType&&this.resize(t),this.lastEvent=null,this.eventType="",e.off(window,"mousemove.resize touchmove.resize"),e.off(window,"mouseup.resize touchend.resize")}snapToGrid(t){return this.grid&&(t.x=Math.round(t.x/this.grid)*this.grid,t.y=Math.round(t.y/this.grid)*this.grid),t}snapToAngle(t){return this.degree&&(t=Math.round(t/this.degree)*this.degree),t}}return e.extend(e.Element,{resize:function(t=!0,e={}){"object"==typeof t&&(e=t,t=!0);let i=this.remember("_ResizeHandler");return i||(t.prototype instanceof r?(i=new t(this),t=!0):i=new r(this),this.remember("_resizeHandler",i)),i.active(t,e),this}}),t.ResizeHandler=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t}({},SVG);
//# sourceMappingURL=svg.resize.iife.js.map
