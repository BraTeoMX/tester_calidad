{"version":3,"file":"svg.filter.node.js","sources":["../src/svg.filter.js"],"sourcesContent":["import {\n  Array as SVGArray,\n  Container,\n  Defs,\n  Element,\n  extend,\n  find,\n  namespaces as ns,\n  nodeOrNew,\n  utils,\n  wrapWithAttrCheck\n} from '@svgdotjs/svg.js'\n\nexport default class Filter extends Element {\n  constructor (node) {\n    super(nodeOrNew('filter', node), node)\n\n    this.$source = 'SourceGraphic'\n    this.$sourceAlpha = 'SourceAlpha'\n    this.$background = 'BackgroundImage'\n    this.$backgroundAlpha = 'BackgroundAlpha'\n    this.$fill = 'FillPaint'\n    this.$stroke = 'StrokePaint'\n    this.$autoSetIn = true\n  }\n\n  put (element, i) {\n    element = super.put(element, i)\n\n    if (!element.attr('in') && this.$autoSetIn) {\n      element.attr('in', this.$source)\n    }\n    if (!element.attr('result')) {\n      element.attr('result', element.id())\n    }\n\n    return element\n  }\n\n  // Unmask all masked elements and remove itself\n  remove () {\n    // unmask all targets\n    this.targets().each('unfilter')\n\n    // remove mask from parent\n    return super.remove()\n  }\n\n  targets () {\n    return find('svg [filter*=\"' + this.id() + '\"]')\n  }\n\n  toString () {\n    return 'url(#' + this.id() + ')'\n  }\n}\n\n// Create Effect class\nclass Effect extends Element {\n  constructor (node, attr) {\n    super(node, attr)\n    this.result(this.id())\n  }\n\n  in (effect) {\n    // Act as getter\n    if (effect == null) {\n      const _in = this.attr('in')\n      const ref = this.parent() && this.parent().find(`[result=\"${_in}\"]`)[0]\n      return ref || _in\n    }\n\n    // Avr as setter\n    return this.attr('in', effect)\n  }\n\n  // Named result\n  result (result) {\n    return this.attr('result', result)\n  }\n\n  // Stringification\n  toString () {\n    return this.result()\n  }\n}\n\n// This function takes an array with attr keys and sets for every key the\n// attribute to the value of one paramater\n// getAttrSetter(['a', 'b']) becomes this.attr({a: param1, b: param2})\nconst getAttrSetter = (params) => {\n  return function (...args) {\n    for (let i = params.length; i--;) {\n      if (args[i] != null) {\n        this.attr(params[i], args[i])\n      }\n    }\n  }\n}\n\nconst updateFunctions = {\n  blend: getAttrSetter(['in', 'in2', 'mode']),\n  // ColorMatrix effect\n  colorMatrix: getAttrSetter(['type', 'values']),\n  // Composite effect\n  composite: getAttrSetter(['in', 'in2', 'operator']),\n  // ConvolveMatrix effect\n  convolveMatrix: function (matrix) {\n    matrix = new SVGArray(matrix).toString()\n\n    this.attr({\n      order: Math.sqrt(matrix.split(' ').length),\n      kernelMatrix: matrix\n    })\n  },\n  // DiffuseLighting effect\n  diffuseLighting: getAttrSetter(['surfaceScale', 'lightingColor', 'diffuseConstant', 'kernelUnitLength']),\n  // DisplacementMap effect\n  displacementMap: getAttrSetter(['in', 'in2', 'scale', 'xChannelSelector', 'yChannelSelector']),\n  // DropShadow effect\n  dropShadow: getAttrSetter(['in', 'dx', 'dy', 'stdDeviation']),\n  // Flood effect\n  flood: getAttrSetter(['flood-color', 'flood-opacity']),\n  // Gaussian Blur effect\n  gaussianBlur: function (x = 0, y = x) {\n    this.attr('stdDeviation', x + ' ' + y)\n  },\n  // Image effect\n  image: function (src) {\n    this.attr('href', src, ns.xlink)\n  },\n  // Morphology effect\n  morphology: getAttrSetter(['operator', 'radius']),\n  // Offset effect\n  offset: getAttrSetter(['dx', 'dy']),\n  // SpecularLighting effect\n  specularLighting: getAttrSetter(['surfaceScale', 'lightingColor', 'diffuseConstant', 'specularExponent', 'kernelUnitLength']),\n  // Tile effect\n  tile: getAttrSetter([]),\n  // Turbulence effect\n  turbulence: getAttrSetter(['baseFrequency', 'numOctaves', 'seed', 'stitchTiles', 'type'])\n}\n\nconst filterNames = [\n  'blend',\n  'colorMatrix',\n  'componentTransfer',\n  'composite',\n  'convolveMatrix',\n  'diffuseLighting',\n  'displacementMap',\n  'dropShadow',\n  'flood',\n  'gaussianBlur',\n  'image',\n  'merge',\n  'morphology',\n  'offset',\n  'specularLighting',\n  'tile',\n  'turbulence'\n]\n\n// For every filter create a class\nfilterNames.forEach((effect) => {\n  const name = utils.capitalize(effect)\n  const fn = updateFunctions[effect]\n\n  Filter[name + 'Effect'] = class extends Effect {\n    constructor (node) {\n      super(nodeOrNew('fe' + name, node), node)\n    }\n\n    // This function takes all parameters from the factory call\n    // and updates the attributes according to the updateFunctions\n    update (args) {\n      fn.apply(this, args)\n      return this\n    }\n  }\n\n  // Add factory function to filter\n  // Allow to pass a function or object\n  // The attr object is catched from \"wrapWithAttrCheck\"\n  Filter.prototype[effect] = wrapWithAttrCheck(function (fn, ...args) {\n    const effect = new Filter[name + 'Effect']()\n\n    if (fn == null) return this.put(effect)\n\n    // For Effects which can take children, a function is allowed\n    if (typeof fn === 'function') {\n      fn.call(effect, effect)\n    } else {\n      // In case it is not a function, add it to arguments\n      args.unshift(fn)\n    }\n    return this.put(effect).update(args)\n  })\n})\n\n// Correct factories which are not that simple\nextend(Filter, {\n  merge (arrayOrFn) {\n    const node = this.put(new Filter.MergeEffect())\n\n    // If a function was passed, execute it\n    // That makes stuff like this possible:\n    // filter.merge((mergeEffect) => mergeEffect.mergeNode(in))\n    if (typeof arrayOrFn === 'function') {\n      arrayOrFn.call(node, node)\n      return node\n    }\n\n    // Check if first child is an array, otherwise use arguments as array\n    const children = arrayOrFn instanceof Array ? arrayOrFn : [...arguments]\n\n    children.forEach((child) => {\n      if (child instanceof Filter.MergeNode) {\n        node.put(child)\n      } else {\n        node.mergeNode(child)\n      }\n    })\n\n    return node\n  },\n  componentTransfer (components = {}) {\n    const node = this.put(new Filter.ComponentTransferEffect())\n\n    if (typeof components === 'function') {\n      components.call(node, node)\n      return node\n    }\n\n    // If no component is set, we use the given object for all components\n    if (!components.r && !components.g && !components.b && !components.a) {\n      const temp = components\n      components = {\n        r: temp, g: temp, b: temp, a: temp\n      }\n    }\n\n    for (const c in components) {\n      // components[c] has to hold an attributes object\n      node.add(new Filter['Func' + c.toUpperCase()](components[c]))\n    }\n\n    return node\n  }\n})\n\nconst filterChildNodes = [\n  'distantLight',\n  'pointLight',\n  'spotLight',\n  'mergeNode',\n  'FuncR',\n  'FuncG',\n  'FuncB',\n  'FuncA'\n]\n\nfilterChildNodes.forEach((child) => {\n  const name = utils.capitalize(child)\n  Filter[name] = class extends Effect {\n    constructor (node) {\n      super(nodeOrNew('fe' + name, node), node)\n    }\n  }\n})\n\nconst componentFuncs = [\n  'funcR',\n  'funcG',\n  'funcB',\n  'funcA'\n]\n\n// Add an update function for componentTransfer-children\ncomponentFuncs.forEach(function (c) {\n  const _class = Filter[utils.capitalize(c)]\n  const fn = wrapWithAttrCheck(function () {\n    return this.put(new _class())\n  })\n\n  Filter.ComponentTransferEffect.prototype[c] = fn\n})\n\nconst lights = [\n  'distantLight',\n  'pointLight',\n  'spotLight'\n]\n\n// Add light sources factories to lightining effects\nlights.forEach((light) => {\n  const _class = Filter[utils.capitalize(light)]\n  const fn = wrapWithAttrCheck(function () {\n    return this.put(new _class())\n  })\n\n  Filter.DiffuseLightingEffect.prototype[light] = fn\n  Filter.SpecularLightingEffect.prototype[light] = fn\n})\n\nextend(Filter.MergeEffect, {\n  mergeNode (_in) {\n    return this.put(new Filter.MergeNode()).attr('in', _in)\n  }\n})\n\n// add .filter function\nextend(Defs, {\n  // Define filter\n  filter: function (block) {\n    const filter = this.put(new Filter())\n\n    /* invoke passed block */\n    if (typeof block === 'function') { block.call(filter, filter) }\n\n    return filter\n  }\n})\n\nextend(Container, {\n  // Define filter on defs\n  filter: function (block) {\n    return this.defs().filter(block)\n  }\n})\n\nextend(Element, {\n  // Create filter element in defs and store reference\n  filterWith: function (block) {\n    const filter = block instanceof Filter\n      ? block\n      : this.defs().filter(block)\n\n    return this.attr('filter', filter)\n  },\n  // Remove filter\n  unfilter: function (remove) {\n    /* remove filter attribute */\n    return this.attr('filter', null)\n  },\n  filterer () {\n    return this.reference('filter')\n  }\n})\n\n// chaining\nconst chainingEffects = {\n  // Blend effect\n  blend: function (in2, mode) {\n    return this.parent() && this.parent().blend(this, in2, mode) // pass this as the first input\n  },\n  // ColorMatrix effect\n  colorMatrix: function (type, values) {\n    return this.parent() && this.parent().colorMatrix(type, values).in(this)\n  },\n  // ComponentTransfer effect\n  componentTransfer: function (components) {\n    return this.parent() && this.parent().componentTransfer(components).in(this)\n  },\n  // Composite effect\n  composite: function (in2, operator) {\n    return this.parent() && this.parent().composite(this, in2, operator) // pass this as the first input\n  },\n  // ConvolveMatrix effect\n  convolveMatrix: function (matrix) {\n    return this.parent() && this.parent().convolveMatrix(matrix).in(this)\n  },\n  // DiffuseLighting effect\n  diffuseLighting: function (surfaceScale, lightingColor, diffuseConstant, kernelUnitLength) {\n    return this.parent() && this.parent().diffuseLighting(surfaceScale, diffuseConstant, kernelUnitLength).in(this)\n  },\n  // DisplacementMap effect\n  displacementMap: function (in2, scale, xChannelSelector, yChannelSelector) {\n    return this.parent() && this.parent().displacementMap(this, in2, scale, xChannelSelector, yChannelSelector) // pass this as the first input\n  },\n  // DisplacementMap effect\n  dropShadow: function (x, y, stdDeviation) {\n    return this.parent() && this.parent().dropShadow(this, x, y, stdDeviation).in(this) // pass this as the first input\n  },\n  // Flood effect\n  flood: function (color, opacity) {\n    return this.parent() && this.parent().flood(color, opacity) // this effect dont have inputs\n  },\n  // Gaussian Blur effect\n  gaussianBlur: function (x, y) {\n    return this.parent() && this.parent().gaussianBlur(x, y).in(this)\n  },\n  // Image effect\n  image: function (src) {\n    return this.parent() && this.parent().image(src) // this effect dont have inputs\n  },\n  // Merge effect\n  merge: function (arg) {\n    arg = arg instanceof Array ? arg : [...arg]\n    return this.parent() && this.parent().merge(this, ...arg) // pass this as the first argument\n  },\n  // Morphology effect\n  morphology: function (operator, radius) {\n    return this.parent() && this.parent().morphology(operator, radius).in(this)\n  },\n  // Offset effect\n  offset: function (dx, dy) {\n    return this.parent() && this.parent().offset(dx, dy).in(this)\n  },\n  // SpecularLighting effect\n  specularLighting: function (surfaceScale, lightingColor, diffuseConstant, specularExponent, kernelUnitLength) {\n    return this.parent() && this.parent().specularLighting(surfaceScale, diffuseConstant, specularExponent, kernelUnitLength).in(this)\n  },\n  // Tile effect\n  tile: function () {\n    return this.parent() && this.parent().tile().in(this)\n  },\n  // Turbulence effect\n  turbulence: function (baseFrequency, numOctaves, seed, stitchTiles, type) {\n    return this.parent() && this.parent().turbulence(baseFrequency, numOctaves, seed, stitchTiles, type).in(this)\n  }\n}\n\nextend(Effect, chainingEffects)\n\n// Effect-specific extensions\nextend(Filter.MergeEffect, {\n  in: function (effect) {\n    if (effect instanceof Filter.MergeNode) {\n      this.add(effect, 0)\n    } else {\n      this.add(new Filter.MergeNode().in(effect), 0)\n    }\n\n    return this\n  }\n})\n\nextend([Filter.CompositeEffect, Filter.BlendEffect, Filter.DisplacementMapEffect], {\n  in2: function (effect) {\n    if (effect == null) {\n      const in2 = this.attr('in2')\n      const ref = this.parent() && this.parent().find(`[result=\"${in2}\"]`)[0]\n      return ref || in2\n    }\n    return this.attr('in2', effect)\n  }\n})\n\n// Presets\nFilter.filter = {\n  sepiatone: [\n    0.343, 0.669, 0.119, 0, 0,\n    0.249, 0.626, 0.130, 0, 0,\n    0.172, 0.334, 0.111, 0, 0,\n    0.000, 0.000, 0.000, 1, 0]\n}\n"],"names":["Filter","Element","constructor","node","nodeOrNew","$source","$sourceAlpha","$background","$backgroundAlpha","$fill","$stroke","$autoSetIn","put","element","i","attr","id","remove","targets","each","find","toString","Effect","result","in","effect","_in","ref","parent","getAttrSetter","params","args","length","updateFunctions","blend","colorMatrix","composite","convolveMatrix","matrix","SVGArray","order","Math","sqrt","split","kernelMatrix","diffuseLighting","displacementMap","dropShadow","flood","gaussianBlur","x","y","image","src","ns","xlink","morphology","offset","specularLighting","tile","turbulence","filterNames","forEach","name","utils","capitalize","fn","update","apply","prototype","wrapWithAttrCheck","call","unshift","extend","merge","arrayOrFn","MergeEffect","children","Array","arguments","child","MergeNode","mergeNode","componentTransfer","components","ComponentTransferEffect","r","g","b","a","temp","c","add","toUpperCase","filterChildNodes","componentFuncs","_class","lights","light","DiffuseLightingEffect","SpecularLightingEffect","Defs","filter","block","Container","defs","filterWith","unfilter","filterer","reference","chainingEffects","in2","mode","type","values","operator","surfaceScale","lightingColor","diffuseConstant","kernelUnitLength","scale","xChannelSelector","yChannelSelector","stdDeviation","color","opacity","arg","radius","dx","dy","specularExponent","baseFrequency","numOctaves","seed","stitchTiles","CompositeEffect","BlendEffect","DisplacementMapEffect","sepiatone"],"mappings":";;;;;;;;;;;;;;AAae,MAAMA,MAAN,SAAqBC,cAArB,CAA6B;AAC1CC,EAAAA,WAAW,CAAEC,IAAF,EAAQ;AACjB,UAAMC,gBAAS,CAAC,QAAD,EAAWD,IAAX,CAAf,EAAiCA,IAAjC;AAEA,SAAKE,OAAL,GAAe,eAAf;AACA,SAAKC,YAAL,GAAoB,aAApB;AACA,SAAKC,WAAL,GAAmB,iBAAnB;AACA,SAAKC,gBAAL,GAAwB,iBAAxB;AACA,SAAKC,KAAL,GAAa,WAAb;AACA,SAAKC,OAAL,GAAe,aAAf;AACA,SAAKC,UAAL,GAAkB,IAAlB;AACD;;AAEDC,EAAAA,GAAG,CAAEC,OAAF,EAAWC,CAAX,EAAc;AACfD,IAAAA,OAAO,GAAG,MAAMD,GAAN,CAAUC,OAAV,EAAmBC,CAAnB,CAAV;;AAEA,QAAI,CAACD,OAAO,CAACE,IAAR,CAAa,IAAb,CAAD,IAAuB,KAAKJ,UAAhC,EAA4C;AAC1CE,MAAAA,OAAO,CAACE,IAAR,CAAa,IAAb,EAAmB,KAAKV,OAAxB;AACD;;AACD,QAAI,CAACQ,OAAO,CAACE,IAAR,CAAa,QAAb,CAAL,EAA6B;AAC3BF,MAAAA,OAAO,CAACE,IAAR,CAAa,QAAb,EAAuBF,OAAO,CAACG,EAAR,EAAvB;AACD;;AAED,WAAOH,OAAP;AACD,GAxByC;;;AA2B1CI,EAAAA,MAAM,GAAI;AACR;AACA,SAAKC,OAAL,GAAeC,IAAf,CAAoB,UAApB,EAFQ;;AAKR,WAAO,MAAMF,MAAN,EAAP;AACD;;AAEDC,EAAAA,OAAO,GAAI;AACT,WAAOE,WAAI,CAAC,mBAAmB,KAAKJ,EAAL,EAAnB,GAA+B,IAAhC,CAAX;AACD;;AAEDK,EAAAA,QAAQ,GAAI;AACV,WAAO,UAAU,KAAKL,EAAL,EAAV,GAAsB,GAA7B;AACD;;AAzCyC;;AA6C5C,MAAMM,MAAN,SAAqBrB,cAArB,CAA6B;AAC3BC,EAAAA,WAAW,CAAEC,IAAF,EAAQY,IAAR,EAAc;AACvB,UAAMZ,IAAN,EAAYY,IAAZ;AACA,SAAKQ,MAAL,CAAY,KAAKP,EAAL,EAAZ;AACD;;AAEDQ,EAAAA,EAAE,CAAEC,MAAF,EAAU;AACV;AACA,QAAIA,MAAM,IAAI,IAAd,EAAoB;AAClB,YAAMC,GAAG,GAAG,KAAKX,IAAL,CAAU,IAAV,CAAZ;;AACA,YAAMY,GAAG,GAAG,KAAKC,MAAL,MAAiB,KAAKA,MAAL,GAAcR,IAAd,CAAoB,YAAWM,GAAI,IAAnC,EAAwC,CAAxC,CAA7B;AACA,aAAOC,GAAG,IAAID,GAAd;AACD,KANS;;;AASV,WAAO,KAAKX,IAAL,CAAU,IAAV,EAAgBU,MAAhB,CAAP;AACD,GAhB0B;;;AAmB3BF,EAAAA,MAAM,CAAEA,MAAF,EAAU;AACd,WAAO,KAAKR,IAAL,CAAU,QAAV,EAAoBQ,MAApB,CAAP;AACD,GArB0B;;;AAwB3BF,EAAAA,QAAQ,GAAI;AACV,WAAO,KAAKE,MAAL,EAAP;AACD;;AA1B0B;AA8B7B;AACA;;;AACA,MAAMM,aAAa,GAAIC,MAAD,IAAY;AAChC,SAAO,UAAU,GAAGC,IAAb,EAAmB;AACxB,SAAK,IAAIjB,CAAC,GAAGgB,MAAM,CAACE,MAApB,EAA4BlB,CAAC,EAA7B,GAAkC;AAChC,UAAIiB,IAAI,CAACjB,CAAD,CAAJ,IAAW,IAAf,EAAqB;AACnB,aAAKC,IAAL,CAAUe,MAAM,CAAChB,CAAD,CAAhB,EAAqBiB,IAAI,CAACjB,CAAD,CAAzB;AACD;AACF;AACF,GAND;AAOD,CARD;;AAUA,MAAMmB,eAAe,GAAG;AACtBC,EAAAA,KAAK,EAAEL,aAAa,CAAC,CAAC,IAAD,EAAO,KAAP,EAAc,MAAd,CAAD,CADE;AAEtB;AACAM,EAAAA,WAAW,EAAEN,aAAa,CAAC,CAAC,MAAD,EAAS,QAAT,CAAD,CAHJ;AAItB;AACAO,EAAAA,SAAS,EAAEP,aAAa,CAAC,CAAC,IAAD,EAAO,KAAP,EAAc,UAAd,CAAD,CALF;AAMtB;AACAQ,EAAAA,cAAc,EAAE,UAAUC,MAAV,EAAkB;AAChCA,IAAAA,MAAM,GAAG,IAAIC,YAAJ,CAAaD,MAAb,EAAqBjB,QAArB,EAAT;AAEA,SAAKN,IAAL,CAAU;AACRyB,MAAAA,KAAK,EAAEC,IAAI,CAACC,IAAL,CAAUJ,MAAM,CAACK,KAAP,CAAa,GAAb,EAAkBX,MAA5B,CADC;AAERY,MAAAA,YAAY,EAAEN;AAFN,KAAV;AAID,GAdqB;AAetB;AACAO,EAAAA,eAAe,EAAEhB,aAAa,CAAC,CAAC,cAAD,EAAiB,eAAjB,EAAkC,iBAAlC,EAAqD,kBAArD,CAAD,CAhBR;AAiBtB;AACAiB,EAAAA,eAAe,EAAEjB,aAAa,CAAC,CAAC,IAAD,EAAO,KAAP,EAAc,OAAd,EAAuB,kBAAvB,EAA2C,kBAA3C,CAAD,CAlBR;AAmBtB;AACAkB,EAAAA,UAAU,EAAElB,aAAa,CAAC,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,cAAnB,CAAD,CApBH;AAqBtB;AACAmB,EAAAA,KAAK,EAAEnB,aAAa,CAAC,CAAC,aAAD,EAAgB,eAAhB,CAAD,CAtBE;AAuBtB;AACAoB,EAAAA,YAAY,EAAE,UAAUC,CAAC,GAAG,CAAd,EAAiBC,CAAC,GAAGD,CAArB,EAAwB;AACpC,SAAKnC,IAAL,CAAU,cAAV,EAA0BmC,CAAC,GAAG,GAAJ,GAAUC,CAApC;AACD,GA1BqB;AA2BtB;AACAC,EAAAA,KAAK,EAAE,UAAUC,GAAV,EAAe;AACpB,SAAKtC,IAAL,CAAU,MAAV,EAAkBsC,GAAlB,EAAuBC,iBAAE,CAACC,KAA1B;AACD,GA9BqB;AA+BtB;AACAC,EAAAA,UAAU,EAAE3B,aAAa,CAAC,CAAC,UAAD,EAAa,QAAb,CAAD,CAhCH;AAiCtB;AACA4B,EAAAA,MAAM,EAAE5B,aAAa,CAAC,CAAC,IAAD,EAAO,IAAP,CAAD,CAlCC;AAmCtB;AACA6B,EAAAA,gBAAgB,EAAE7B,aAAa,CAAC,CAAC,cAAD,EAAiB,eAAjB,EAAkC,iBAAlC,EAAqD,kBAArD,EAAyE,kBAAzE,CAAD,CApCT;AAqCtB;AACA8B,EAAAA,IAAI,EAAE9B,aAAa,CAAC,EAAD,CAtCG;AAuCtB;AACA+B,EAAAA,UAAU,EAAE/B,aAAa,CAAC,CAAC,eAAD,EAAkB,YAAlB,EAAgC,MAAhC,EAAwC,aAAxC,EAAuD,MAAvD,CAAD;AAxCH,CAAxB;AA2CA,MAAMgC,WAAW,GAAG,CAClB,OADkB,EAElB,aAFkB,EAGlB,mBAHkB,EAIlB,WAJkB,EAKlB,gBALkB,EAMlB,iBANkB,EAOlB,iBAPkB,EAQlB,YARkB,EASlB,OATkB,EAUlB,cAVkB,EAWlB,OAXkB,EAYlB,OAZkB,EAalB,YAbkB,EAclB,QAdkB,EAelB,kBAfkB,EAgBlB,MAhBkB,EAiBlB,YAjBkB,CAApB;;AAqBAA,WAAW,CAACC,OAAZ,CAAqBrC,MAAD,IAAY;AAC9B,QAAMsC,IAAI,GAAGC,YAAK,CAACC,UAAN,CAAiBxC,MAAjB,CAAb;AACA,QAAMyC,EAAE,GAAGjC,eAAe,CAACR,MAAD,CAA1B;AAEAzB,EAAAA,MAAM,CAAC+D,IAAI,GAAG,QAAR,CAAN,GAA0B,cAAczC,MAAd,CAAqB;AAC7CpB,IAAAA,WAAW,CAAEC,IAAF,EAAQ;AACjB,YAAMC,gBAAS,CAAC,OAAO2D,IAAR,EAAc5D,IAAd,CAAf,EAAoCA,IAApC;AACD,KAH4C;AAM7C;;;AACAgE,IAAAA,MAAM,CAAEpC,IAAF,EAAQ;AACZmC,MAAAA,EAAE,CAACE,KAAH,CAAS,IAAT,EAAerC,IAAf;AACA,aAAO,IAAP;AACD;;AAV4C,GAA/C,CAJ8B;AAkB9B;AACA;;AACA/B,EAAAA,MAAM,CAACqE,SAAP,CAAiB5C,MAAjB,IAA2B6C,wBAAiB,CAAC,UAAUJ,EAAV,EAAc,GAAGnC,IAAjB,EAAuB;AAClE,UAAMN,MAAM,GAAG,IAAIzB,MAAM,CAAC+D,IAAI,GAAG,QAAR,CAAV,EAAf;AAEA,QAAIG,EAAE,IAAI,IAAV,EAAgB,OAAO,KAAKtD,GAAL,CAASa,MAAT,CAAP,CAHkD;;AAMlE,QAAI,OAAOyC,EAAP,KAAc,UAAlB,EAA8B;AAC5BA,MAAAA,EAAE,CAACK,IAAH,CAAQ9C,MAAR,EAAgBA,MAAhB;AACD,KAFD,MAEO;AACL;AACAM,MAAAA,IAAI,CAACyC,OAAL,CAAaN,EAAb;AACD;;AACD,WAAO,KAAKtD,GAAL,CAASa,MAAT,EAAiB0C,MAAjB,CAAwBpC,IAAxB,CAAP;AACD,GAb2C,CAA5C;AAcD,CAlCD;;AAqCA0C,aAAM,CAACzE,MAAD,EAAS;AACb0E,EAAAA,KAAK,CAAEC,SAAF,EAAa;AAChB,UAAMxE,IAAI,GAAG,KAAKS,GAAL,CAAS,IAAIZ,MAAM,CAAC4E,WAAX,EAAT,CAAb,CADgB;AAIhB;AACA;;AACA,QAAI,OAAOD,SAAP,KAAqB,UAAzB,EAAqC;AACnCA,MAAAA,SAAS,CAACJ,IAAV,CAAepE,IAAf,EAAqBA,IAArB;AACA,aAAOA,IAAP;AACD,KATe;;;AAYhB,UAAM0E,QAAQ,GAAGF,SAAS,YAAYG,KAArB,GAA6BH,SAA7B,GAAyC,CAAC,GAAGI,SAAJ,CAA1D;AAEAF,IAAAA,QAAQ,CAACf,OAAT,CAAkBkB,KAAD,IAAW;AAC1B,UAAIA,KAAK,YAAYhF,MAAM,CAACiF,SAA5B,EAAuC;AACrC9E,QAAAA,IAAI,CAACS,GAAL,CAASoE,KAAT;AACD,OAFD,MAEO;AACL7E,QAAAA,IAAI,CAAC+E,SAAL,CAAeF,KAAf;AACD;AACF,KAND;AAQA,WAAO7E,IAAP;AACD,GAxBY;;AAyBbgF,EAAAA,iBAAiB,CAAEC,UAAU,GAAG,EAAf,EAAmB;AAClC,UAAMjF,IAAI,GAAG,KAAKS,GAAL,CAAS,IAAIZ,MAAM,CAACqF,uBAAX,EAAT,CAAb;;AAEA,QAAI,OAAOD,UAAP,KAAsB,UAA1B,EAAsC;AACpCA,MAAAA,UAAU,CAACb,IAAX,CAAgBpE,IAAhB,EAAsBA,IAAtB;AACA,aAAOA,IAAP;AACD,KANiC;;;AASlC,QAAI,CAACiF,UAAU,CAACE,CAAZ,IAAiB,CAACF,UAAU,CAACG,CAA7B,IAAkC,CAACH,UAAU,CAACI,CAA9C,IAAmD,CAACJ,UAAU,CAACK,CAAnE,EAAsE;AACpE,YAAMC,IAAI,GAAGN,UAAb;AACAA,MAAAA,UAAU,GAAG;AACXE,QAAAA,CAAC,EAAEI,IADQ;AACFH,QAAAA,CAAC,EAAEG,IADD;AACOF,QAAAA,CAAC,EAAEE,IADV;AACgBD,QAAAA,CAAC,EAAEC;AADnB,OAAb;AAGD;;AAED,SAAK,MAAMC,CAAX,IAAgBP,UAAhB,EAA4B;AAC1B;AACAjF,MAAAA,IAAI,CAACyF,GAAL,CAAS,IAAI5F,MAAM,CAAC,SAAS2F,CAAC,CAACE,WAAF,EAAV,CAAV,CAAqCT,UAAU,CAACO,CAAD,CAA/C,CAAT;AACD;;AAED,WAAOxF,IAAP;AACD;;AA/CY,CAAT,CAAN;AAkDA,MAAM2F,gBAAgB,GAAG,CACvB,cADuB,EAEvB,YAFuB,EAGvB,WAHuB,EAIvB,WAJuB,EAKvB,OALuB,EAMvB,OANuB,EAOvB,OAPuB,EAQvB,OARuB,CAAzB;AAWAA,gBAAgB,CAAChC,OAAjB,CAA0BkB,KAAD,IAAW;AAClC,QAAMjB,IAAI,GAAGC,YAAK,CAACC,UAAN,CAAiBe,KAAjB,CAAb;AACAhF,EAAAA,MAAM,CAAC+D,IAAD,CAAN,GAAe,cAAczC,MAAd,CAAqB;AAClCpB,IAAAA,WAAW,CAAEC,IAAF,EAAQ;AACjB,YAAMC,gBAAS,CAAC,OAAO2D,IAAR,EAAc5D,IAAd,CAAf,EAAoCA,IAApC;AACD;;AAHiC,GAApC;AAKD,CAPD;AASA,MAAM4F,cAAc,GAAG,CACrB,OADqB,EAErB,OAFqB,EAGrB,OAHqB,EAIrB,OAJqB,CAAvB;;AAQAA,cAAc,CAACjC,OAAf,CAAuB,UAAU6B,CAAV,EAAa;AAClC,QAAMK,MAAM,GAAGhG,MAAM,CAACgE,YAAK,CAACC,UAAN,CAAiB0B,CAAjB,CAAD,CAArB;AACA,QAAMzB,EAAE,GAAGI,wBAAiB,CAAC,YAAY;AACvC,WAAO,KAAK1D,GAAL,CAAS,IAAIoF,MAAJ,EAAT,CAAP;AACD,GAF2B,CAA5B;AAIAhG,EAAAA,MAAM,CAACqF,uBAAP,CAA+BhB,SAA/B,CAAyCsB,CAAzC,IAA8CzB,EAA9C;AACD,CAPD;AASA,MAAM+B,MAAM,GAAG,CACb,cADa,EAEb,YAFa,EAGb,WAHa,CAAf;;AAOAA,MAAM,CAACnC,OAAP,CAAgBoC,KAAD,IAAW;AACxB,QAAMF,MAAM,GAAGhG,MAAM,CAACgE,YAAK,CAACC,UAAN,CAAiBiC,KAAjB,CAAD,CAArB;AACA,QAAMhC,EAAE,GAAGI,wBAAiB,CAAC,YAAY;AACvC,WAAO,KAAK1D,GAAL,CAAS,IAAIoF,MAAJ,EAAT,CAAP;AACD,GAF2B,CAA5B;AAIAhG,EAAAA,MAAM,CAACmG,qBAAP,CAA6B9B,SAA7B,CAAuC6B,KAAvC,IAAgDhC,EAAhD;AACAlE,EAAAA,MAAM,CAACoG,sBAAP,CAA8B/B,SAA9B,CAAwC6B,KAAxC,IAAiDhC,EAAjD;AACD,CARD;AAUAO,aAAM,CAACzE,MAAM,CAAC4E,WAAR,EAAqB;AACzBM,EAAAA,SAAS,CAAExD,GAAF,EAAO;AACd,WAAO,KAAKd,GAAL,CAAS,IAAIZ,MAAM,CAACiF,SAAX,EAAT,EAAiClE,IAAjC,CAAsC,IAAtC,EAA4CW,GAA5C,CAAP;AACD;;AAHwB,CAArB,CAAN;;AAOA+C,aAAM,CAAC4B,WAAD,EAAO;AACX;AACAC,EAAAA,MAAM,EAAE,UAAUC,KAAV,EAAiB;AACvB,UAAMD,MAAM,GAAG,KAAK1F,GAAL,CAAS,IAAIZ,MAAJ,EAAT,CAAf;AAEA;;AACA,QAAI,OAAOuG,KAAP,KAAiB,UAArB,EAAiC;AAAEA,MAAAA,KAAK,CAAChC,IAAN,CAAW+B,MAAX,EAAmBA,MAAnB;AAA4B;;AAE/D,WAAOA,MAAP;AACD;AATU,CAAP,CAAN;AAYA7B,aAAM,CAAC+B,gBAAD,EAAY;AAChB;AACAF,EAAAA,MAAM,EAAE,UAAUC,KAAV,EAAiB;AACvB,WAAO,KAAKE,IAAL,GAAYH,MAAZ,CAAmBC,KAAnB,CAAP;AACD;AAJe,CAAZ,CAAN;AAOA9B,aAAM,CAACxE,cAAD,EAAU;AACd;AACAyG,EAAAA,UAAU,EAAE,UAAUH,KAAV,EAAiB;AAC3B,UAAMD,MAAM,GAAGC,KAAK,YAAYvG,MAAjB,GACXuG,KADW,GAEX,KAAKE,IAAL,GAAYH,MAAZ,CAAmBC,KAAnB,CAFJ;AAIA,WAAO,KAAKxF,IAAL,CAAU,QAAV,EAAoBuF,MAApB,CAAP;AACD,GARa;AASd;AACAK,EAAAA,QAAQ,EAAE,UAAU1F,MAAV,EAAkB;AAC1B;AACA,WAAO,KAAKF,IAAL,CAAU,QAAV,EAAoB,IAApB,CAAP;AACD,GAba;;AAcd6F,EAAAA,QAAQ,GAAI;AACV,WAAO,KAAKC,SAAL,CAAe,QAAf,CAAP;AACD;;AAhBa,CAAV,CAAN;;AAoBA,MAAMC,eAAe,GAAG;AACtB;AACA5E,EAAAA,KAAK,EAAE,UAAU6E,GAAV,EAAeC,IAAf,EAAqB;AAC1B,WAAO,KAAKpF,MAAL,MAAiB,KAAKA,MAAL,GAAcM,KAAd,CAAoB,IAApB,EAA0B6E,GAA1B,EAA+BC,IAA/B,CAAxB,CAD0B;AAE3B,GAJqB;AAKtB;AACA7E,EAAAA,WAAW,EAAE,UAAU8E,IAAV,EAAgBC,MAAhB,EAAwB;AACnC,WAAO,KAAKtF,MAAL,MAAiB,KAAKA,MAAL,GAAcO,WAAd,CAA0B8E,IAA1B,EAAgCC,MAAhC,EAAwC1F,EAAxC,CAA2C,IAA3C,CAAxB;AACD,GARqB;AAStB;AACA2D,EAAAA,iBAAiB,EAAE,UAAUC,UAAV,EAAsB;AACvC,WAAO,KAAKxD,MAAL,MAAiB,KAAKA,MAAL,GAAcuD,iBAAd,CAAgCC,UAAhC,EAA4C5D,EAA5C,CAA+C,IAA/C,CAAxB;AACD,GAZqB;AAatB;AACAY,EAAAA,SAAS,EAAE,UAAU2E,GAAV,EAAeI,QAAf,EAAyB;AAClC,WAAO,KAAKvF,MAAL,MAAiB,KAAKA,MAAL,GAAcQ,SAAd,CAAwB,IAAxB,EAA8B2E,GAA9B,EAAmCI,QAAnC,CAAxB,CADkC;AAEnC,GAhBqB;AAiBtB;AACA9E,EAAAA,cAAc,EAAE,UAAUC,MAAV,EAAkB;AAChC,WAAO,KAAKV,MAAL,MAAiB,KAAKA,MAAL,GAAcS,cAAd,CAA6BC,MAA7B,EAAqCd,EAArC,CAAwC,IAAxC,CAAxB;AACD,GApBqB;AAqBtB;AACAqB,EAAAA,eAAe,EAAE,UAAUuE,YAAV,EAAwBC,aAAxB,EAAuCC,eAAvC,EAAwDC,gBAAxD,EAA0E;AACzF,WAAO,KAAK3F,MAAL,MAAiB,KAAKA,MAAL,GAAciB,eAAd,CAA8BuE,YAA9B,EAA4CE,eAA5C,EAA6DC,gBAA7D,EAA+E/F,EAA/E,CAAkF,IAAlF,CAAxB;AACD,GAxBqB;AAyBtB;AACAsB,EAAAA,eAAe,EAAE,UAAUiE,GAAV,EAAeS,KAAf,EAAsBC,gBAAtB,EAAwCC,gBAAxC,EAA0D;AACzE,WAAO,KAAK9F,MAAL,MAAiB,KAAKA,MAAL,GAAckB,eAAd,CAA8B,IAA9B,EAAoCiE,GAApC,EAAyCS,KAAzC,EAAgDC,gBAAhD,EAAkEC,gBAAlE,CAAxB,CADyE;AAE1E,GA5BqB;AA6BtB;AACA3E,EAAAA,UAAU,EAAE,UAAUG,CAAV,EAAaC,CAAb,EAAgBwE,YAAhB,EAA8B;AACxC,WAAO,KAAK/F,MAAL,MAAiB,KAAKA,MAAL,GAAcmB,UAAd,CAAyB,IAAzB,EAA+BG,CAA/B,EAAkCC,CAAlC,EAAqCwE,YAArC,EAAmDnG,EAAnD,CAAsD,IAAtD,CAAxB,CADwC;AAEzC,GAhCqB;AAiCtB;AACAwB,EAAAA,KAAK,EAAE,UAAU4E,KAAV,EAAiBC,OAAjB,EAA0B;AAC/B,WAAO,KAAKjG,MAAL,MAAiB,KAAKA,MAAL,GAAcoB,KAAd,CAAoB4E,KAApB,EAA2BC,OAA3B,CAAxB,CAD+B;AAEhC,GApCqB;AAqCtB;AACA5E,EAAAA,YAAY,EAAE,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAC5B,WAAO,KAAKvB,MAAL,MAAiB,KAAKA,MAAL,GAAcqB,YAAd,CAA2BC,CAA3B,EAA8BC,CAA9B,EAAiC3B,EAAjC,CAAoC,IAApC,CAAxB;AACD,GAxCqB;AAyCtB;AACA4B,EAAAA,KAAK,EAAE,UAAUC,GAAV,EAAe;AACpB,WAAO,KAAKzB,MAAL,MAAiB,KAAKA,MAAL,GAAcwB,KAAd,CAAoBC,GAApB,CAAxB,CADoB;AAErB,GA5CqB;AA6CtB;AACAqB,EAAAA,KAAK,EAAE,UAAUoD,GAAV,EAAe;AACpBA,IAAAA,GAAG,GAAGA,GAAG,YAAYhD,KAAf,GAAuBgD,GAAvB,GAA6B,CAAC,GAAGA,GAAJ,CAAnC;AACA,WAAO,KAAKlG,MAAL,MAAiB,KAAKA,MAAL,GAAc8C,KAAd,CAAoB,IAApB,EAA0B,GAAGoD,GAA7B,CAAxB,CAFoB;AAGrB,GAjDqB;AAkDtB;AACAtE,EAAAA,UAAU,EAAE,UAAU2D,QAAV,EAAoBY,MAApB,EAA4B;AACtC,WAAO,KAAKnG,MAAL,MAAiB,KAAKA,MAAL,GAAc4B,UAAd,CAAyB2D,QAAzB,EAAmCY,MAAnC,EAA2CvG,EAA3C,CAA8C,IAA9C,CAAxB;AACD,GArDqB;AAsDtB;AACAiC,EAAAA,MAAM,EAAE,UAAUuE,EAAV,EAAcC,EAAd,EAAkB;AACxB,WAAO,KAAKrG,MAAL,MAAiB,KAAKA,MAAL,GAAc6B,MAAd,CAAqBuE,EAArB,EAAyBC,EAAzB,EAA6BzG,EAA7B,CAAgC,IAAhC,CAAxB;AACD,GAzDqB;AA0DtB;AACAkC,EAAAA,gBAAgB,EAAE,UAAU0D,YAAV,EAAwBC,aAAxB,EAAuCC,eAAvC,EAAwDY,gBAAxD,EAA0EX,gBAA1E,EAA4F;AAC5G,WAAO,KAAK3F,MAAL,MAAiB,KAAKA,MAAL,GAAc8B,gBAAd,CAA+B0D,YAA/B,EAA6CE,eAA7C,EAA8DY,gBAA9D,EAAgFX,gBAAhF,EAAkG/F,EAAlG,CAAqG,IAArG,CAAxB;AACD,GA7DqB;AA8DtB;AACAmC,EAAAA,IAAI,EAAE,YAAY;AAChB,WAAO,KAAK/B,MAAL,MAAiB,KAAKA,MAAL,GAAc+B,IAAd,GAAqBnC,EAArB,CAAwB,IAAxB,CAAxB;AACD,GAjEqB;AAkEtB;AACAoC,EAAAA,UAAU,EAAE,UAAUuE,aAAV,EAAyBC,UAAzB,EAAqCC,IAArC,EAA2CC,WAA3C,EAAwDrB,IAAxD,EAA8D;AACxE,WAAO,KAAKrF,MAAL,MAAiB,KAAKA,MAAL,GAAcgC,UAAd,CAAyBuE,aAAzB,EAAwCC,UAAxC,EAAoDC,IAApD,EAA0DC,WAA1D,EAAuErB,IAAvE,EAA6EzF,EAA7E,CAAgF,IAAhF,CAAxB;AACD;AArEqB,CAAxB;AAwEAiD,aAAM,CAACnD,MAAD,EAASwF,eAAT,CAAN;;AAGArC,aAAM,CAACzE,MAAM,CAAC4E,WAAR,EAAqB;AACzBpD,EAAAA,EAAE,EAAE,UAAUC,MAAV,EAAkB;AACpB,QAAIA,MAAM,YAAYzB,MAAM,CAACiF,SAA7B,EAAwC;AACtC,WAAKW,GAAL,CAASnE,MAAT,EAAiB,CAAjB;AACD,KAFD,MAEO;AACL,WAAKmE,GAAL,CAAS,IAAI5F,MAAM,CAACiF,SAAX,GAAuBzD,EAAvB,CAA0BC,MAA1B,CAAT,EAA4C,CAA5C;AACD;;AAED,WAAO,IAAP;AACD;AATwB,CAArB,CAAN;AAYAgD,aAAM,CAAC,CAACzE,MAAM,CAACuI,eAAR,EAAyBvI,MAAM,CAACwI,WAAhC,EAA6CxI,MAAM,CAACyI,qBAApD,CAAD,EAA6E;AACjF1B,EAAAA,GAAG,EAAE,UAAUtF,MAAV,EAAkB;AACrB,QAAIA,MAAM,IAAI,IAAd,EAAoB;AAClB,YAAMsF,GAAG,GAAG,KAAKhG,IAAL,CAAU,KAAV,CAAZ;AACA,YAAMY,GAAG,GAAG,KAAKC,MAAL,MAAiB,KAAKA,MAAL,GAAcR,IAAd,CAAoB,YAAW2F,GAAI,IAAnC,EAAwC,CAAxC,CAA7B;AACA,aAAOpF,GAAG,IAAIoF,GAAd;AACD;;AACD,WAAO,KAAKhG,IAAL,CAAU,KAAV,EAAiBU,MAAjB,CAAP;AACD;AARgF,CAA7E,CAAN;;AAYAzB,MAAM,CAACsG,MAAP,GAAgB;AACdoC,EAAAA,SAAS,EAAE,CACT,KADS,EACF,KADE,EACK,KADL,EACY,CADZ,EACe,CADf,EAET,KAFS,EAEF,KAFE,EAEK,KAFL,EAEY,CAFZ,EAEe,CAFf,EAGT,KAHS,EAGF,KAHE,EAGK,KAHL,EAGY,CAHZ,EAGe,CAHf,EAIT,KAJS,EAIF,KAJE,EAIK,KAJL,EAIY,CAJZ,EAIe,CAJf;AADG,CAAhB;;;;"}