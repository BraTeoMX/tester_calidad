var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { LitElement, html } from 'lit';
import { property, queryAssignedElements } from 'lit/decorators.js';
import { addKeybindings, altKey, arrowDown, arrowUp, endKey, homeKey, shiftKey, } from '../common/controllers/key-bindings.js';
import { blazorSuppress } from '../common/decorators/blazorSuppress.js';
import { registerComponent } from '../common/definitions/register.js';
import IgcExpansionPanelComponent from '../expansion-panel/expansion-panel.js';
import { styles } from './themes/accordion.base.css.js';
class IgcAccordionComponent extends LitElement {
    static register() {
        registerComponent(IgcAccordionComponent, IgcExpansionPanelComponent);
    }
    get firstEnabled() {
        return this.enabledPanels[0];
    }
    get lastEnabled() {
        return this.enabledPanels[this.enabledPanels.length - 1];
    }
    constructor() {
        super();
        this.singleExpand = false;
        this.addEventListener('igcOpening', this.handlePanelOpening);
        addKeybindings(this, {
            skip: this.skipKeybinding,
            bindingDefaults: { preventDefault: true },
        })
            .set(homeKey, () => this.getPanelHeader(this.firstEnabled).focus())
            .set(endKey, () => this.getPanelHeader(this.lastEnabled).focus())
            .set(arrowUp, this.navigatePrev)
            .set(arrowDown, this.navigateNext)
            .set([shiftKey, altKey, arrowDown], this.expandAll)
            .set([shiftKey, altKey, arrowUp], this.collapseAll);
    }
    skipKeybinding(target) {
        return !(target.matches(IgcExpansionPanelComponent.tagName) &&
            this.enabledPanels.includes(target));
    }
    navigatePrev(event) {
        const current = event.target;
        const next = this.getNextPanel(current, -1);
        if (event.altKey || next === current) {
            return;
        }
        this.getPanelHeader(next).focus();
    }
    navigateNext(event) {
        const current = event.target;
        const next = this.getNextPanel(current, 1);
        if (event.altKey || next === current) {
            return;
        }
        this.getPanelHeader(next).focus();
    }
    collapseAll() {
        const panels = this.enabledPanels;
        for (const panel of panels) {
            this.closePanel(panel);
        }
    }
    expandAll(event) {
        const current = event.target;
        const panels = this.enabledPanels;
        if (this.singleExpand) {
            for (const panel of panels) {
                current === panel ? this.openPanel(panel) : this.closePanel(panel);
            }
        }
        else {
            for (const panel of panels) {
                this.openPanel(panel);
            }
        }
    }
    handlePanelOpening(event) {
        const panel = event.target;
        if (!this.singleExpand || !this.panels.includes(panel)) {
            return;
        }
        this.enabledPanels.forEach((p) => {
            if (p.open && p !== panel) {
                this.closePanel(p);
            }
        });
    }
    getNextPanel(panel, dir = 1) {
        const idx = this.enabledPanels.indexOf(panel);
        return this.enabledPanels[idx + dir] || panel;
    }
    getPanelHeader(panel) {
        return panel.shadowRoot?.querySelector('div[part="header"]');
    }
    async closePanel(panel) {
        if (!panel.open) {
            return;
        }
        if (!panel.emitEvent('igcClosing', { cancelable: true, detail: panel })) {
            return;
        }
        panel.hide();
        await panel.updateComplete;
        panel.emitEvent('igcClosed', { detail: panel });
    }
    async openPanel(panel) {
        if (panel.open) {
            return;
        }
        if (!panel.emitEvent('igcOpening', { cancelable: true, detail: panel })) {
            return;
        }
        panel.show();
        await panel.updateComplete;
        panel.emitEvent('igcOpened', { detail: panel });
    }
    hideAll() {
        this.panels.forEach((p) => p.hide());
    }
    showAll() {
        this.panels.forEach((p) => p.show());
    }
    render() {
        return html `<slot></slot>`;
    }
}
IgcAccordionComponent.tagName = 'igc-accordion';
IgcAccordionComponent.styles = styles;
export default IgcAccordionComponent;
__decorate([
    queryAssignedElements({ selector: 'igc-expansion-panel:not([disabled])' })
], IgcAccordionComponent.prototype, "enabledPanels", void 0);
__decorate([
    property({ attribute: 'single-expand', reflect: true, type: Boolean })
], IgcAccordionComponent.prototype, "singleExpand", void 0);
__decorate([
    queryAssignedElements({ selector: 'igc-expansion-panel' }),
    blazorSuppress()
], IgcAccordionComponent.prototype, "panels", void 0);
//# sourceMappingURL=accordion.js.map