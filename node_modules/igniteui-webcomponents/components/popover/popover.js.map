{"version":3,"file":"popover.js","sourceRoot":"","sources":["../../../src/components/popover/popover.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  type Middleware,\n  autoUpdate,\n  computePosition,\n  flip,\n  limitShift,\n  offset,\n  shift,\n  size,\n} from '@floating-ui/dom';\nimport { LitElement, html } from 'lit';\nimport { property, query, queryAssignedElements } from 'lit/decorators.js';\n\nimport { watch } from '../common/decorators/watch.js';\nimport { registerComponent } from '../common/definitions/register.js';\nimport { getElementByIdFromRoot } from '../common/util.js';\nimport { styles } from './themes/light/popover.base.css.js';\n\nfunction roundByDPR(value: number) {\n  const dpr = globalThis.devicePixelRatio || 1;\n  return Math.round(value * dpr) / dpr;\n}\n\n/**\n * Describes the preferred placement of a toggle component.\n */\nexport type IgcPlacement =\n  | 'top'\n  | 'top-start'\n  | 'top-end'\n  | 'bottom'\n  | 'bottom-start'\n  | 'bottom-end'\n  | 'right'\n  | 'right-start'\n  | 'right-end'\n  | 'left'\n  | 'left-start'\n  | 'left-end';\n\n/* blazorSuppress */\n/**\n * @element igc-popover\n *\n * @slot - Content of the popover.\n * @slot anchor - The element the popover will be anchored to.\n *\n * @csspart container - The container wrapping the slotted content in the popover.\n */\nexport default class IgcPopoverComponent extends LitElement {\n  public static readonly tagName = 'igc-popover';\n  public static override styles = styles;\n\n  /* blazorSuppress */\n  public static register() {\n    registerComponent(IgcPopoverComponent);\n  }\n\n  private dispose?: ReturnType<typeof autoUpdate>;\n  private target?: Element;\n\n  @query('#container', true)\n  private _container!: HTMLElement;\n\n  @queryAssignedElements({ slot: 'anchor', flatten: true })\n  private _anchors!: HTMLElement[];\n\n  /**\n   * Pass an IDREF or an DOM element reference to use as the\n   * anchor target for the floating element.\n   */\n  @property()\n  public anchor?: Element | string;\n\n  /**\n   * When enabled this changes the placement of the floating element in order to keep it\n   * in view along the main axis.\n   */\n  @property({ type: Boolean, reflect: true })\n  public flip = false;\n\n  /**\n   * Placement modifier which translates the floating element along the main axis.\n   */\n  @property({ type: Number })\n  public offset = 0;\n\n  /**\n   * The visibility state of the popover component.\n   */\n  @property({ type: Boolean, reflect: true })\n  public open = false;\n\n  /**\n   * Where to place the floating element relative to the parent anchor element.\n   */\n  @property()\n  public placement: IgcPlacement = 'bottom-start';\n\n  /**\n   * When enabled the floating element will match the width of its parent anchor element.\n   */\n  @property({ type: Boolean, reflect: true, attribute: 'same-width' })\n  public sameWidth = false;\n\n  /**\n   * When enabled this tries to shift the floating element along the main axis\n   * keeping it in view, preventing overflow while maintaining the desired placement.\n   */\n  @property({ type: Boolean, reflect: true })\n  public shift = false;\n\n  @watch('anchor')\n  protected async anchorChange() {\n    const newTarget =\n      typeof this.anchor === 'string'\n        ? getElementByIdFromRoot(this, this.anchor)\n        : this.anchor;\n\n    if (newTarget) {\n      this.target = newTarget;\n      this._updateState();\n    }\n  }\n\n  @watch('open', { waitUntilFirstUpdate: true })\n  protected openChange() {\n    this.open ? this.show() : this.hide();\n  }\n\n  @watch('flip', { waitUntilFirstUpdate: true })\n  @watch('offset', { waitUntilFirstUpdate: true })\n  @watch('placement', { waitUntilFirstUpdate: true })\n  @watch('sameWidth', { waitUntilFirstUpdate: true })\n  @watch('shift', { waitUntilFirstUpdate: true })\n  protected floatingPropChange() {\n    this._updateState();\n  }\n\n  public override async connectedCallback() {\n    super.connectedCallback();\n\n    await this.updateComplete;\n    if (this.open) {\n      this.show();\n    }\n  }\n\n  public override disconnectedCallback() {\n    this.hide();\n    super.disconnectedCallback();\n  }\n\n  protected show() {\n    if (!this.target) return;\n    this._showPopover();\n\n    this.dispose = autoUpdate(\n      this.target,\n      this._container,\n      this._updatePosition.bind(this)\n    );\n  }\n\n  protected async hide(): Promise<void> {\n    this._hidePopover();\n\n    return new Promise((resolve) => {\n      this.dispose?.();\n      this.dispose = undefined;\n      resolve();\n    });\n  }\n\n  private _showPopover() {\n    this._container?.showPopover();\n  }\n\n  private _hidePopover() {\n    this._container?.hidePopover();\n  }\n\n  private _createMiddleware(): Middleware[] {\n    const middleware: Middleware[] = [];\n    const styles = this._container.style;\n\n    if (this.offset) {\n      middleware.push(offset(this.offset));\n    }\n\n    if (this.shift) {\n      middleware.push(\n        shift({\n          limiter: limitShift(),\n        })\n      );\n    }\n\n    if (this.flip) {\n      middleware.push(flip());\n    }\n\n    if (this.sameWidth) {\n      middleware.push(\n        size({\n          apply: ({ rects }) => {\n            Object.assign(styles, { width: `${rects.reference.width}px` });\n          },\n        })\n      );\n    } else {\n      Object.assign(styles, { width: '' });\n    }\n\n    return middleware;\n  }\n\n  private async _updateState() {\n    if (this.open) {\n      await this.hide();\n      this.show();\n    }\n  }\n\n  private async _updatePosition() {\n    if (!this.open || !this.target) {\n      return;\n    }\n\n    const { x, y } = await computePosition(this.target, this._container, {\n      placement: this.placement ?? 'bottom-start',\n      middleware: this._createMiddleware(),\n      strategy: 'fixed',\n    });\n\n    Object.assign(this._container.style, {\n      left: 0,\n      top: 0,\n      transform: `translate(${roundByDPR(x)}px,${roundByDPR(y)}px)`,\n    });\n  }\n\n  private _anchorSlotChange() {\n    if (this.anchor || this._anchors.length < 1) return;\n\n    this.target = this._anchors[0];\n    this._updateState();\n  }\n\n  protected override render() {\n    return html`\n      <slot name=\"anchor\" @slotchange=${this._anchorSlotChange}></slot>\n      <div id=\"container\" part=\"container\" popover=\"manual\">\n        <slot></slot>\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'igc-popover': IgcPopoverComponent;\n  }\n}\n"]}